<!-- CONSULTA DE OFERECIMENTOS -->
<script>
    $('#btnConsultaOferecimentos').on('click', function () {
        atualizaGridOferecimentos();
    });

    $("#gridOferecimentos").bootstrapTable({
        url: "/api/oferecimentos",
        pageSize: 10,
        pagination: true,
        locale: 'pt-BR',
        queryParams: function(params){
            return {
                limit: params.limit,
                offset: params.offset,
                order: params.order,
                txConsulta: $('#txConsultaOferecimento').val()
            };
        },
        pagelist: [10, 100, 250], sidePagination: 'server',
        columns: [
            {field: 'usuarionome', title: 'Nome', width: '45%'},
            {field: 'usuariousr', title: 'Usu√°rio', width: '15%'},
            {field: 'disciplina', title: 'Disciplina', width: '30%'},
            {field: 'sigla', title: 'Curso', width: '10%'}
        ],
        onClickRow: function (row) {
            $('#oferecimentoSelecionado').html(row.usuariousr + '-' + row.periodonome + '-' + row.disciplina);
            $('#oferecimentoSelecionado').val(row.usuariousr + '-' + row.periodonome + '-' + row.disciplina);
            $('#oferecimentoid').val(row.id);
        }
    });

    function atualizaGridOferecimentos() {
        $("#gridOferecimentos").bootstrapTable('refresh', {
            url: "/api/oferecimentos",
            query: {
                txConsulta: $('#txConsultaOferecimento').val()
            }
        });
    }
</script>

<!-- CANCELA OFERECIMENTOS -->
<script>
    $('#cancelarOferecimento').on('click', function () {
        var oferecimentoNovo = new Oferecimento();

        if (!oferecimentoNovo.validaOferecimentoSelecionado($('#oferecimentoid').val()))
            return;
        oferecimentoNovo.id = $('#oferecimentoid').val();

        var admin = new Admin();
        var titulo = "Cancelamento de oferecimento";
        var conteudo = "Deseja cancelar o oferecimento \'"
                + $('#oferecimentoSelecionado').val() + "\'?";

        var callback = function () {
            $.ajax({
                url: '/api/oferecimento/' + oferecimentoNovo.id,
                type: 'delete',
                success: function (data, status) {
                    $.Notify({
                        caption: data.title,
                        content: data.msg,
                        timeout: 10000,
                        type: data.status
                    });
                    if (data.status === 'success') {
                        atualizaGridOferecimentos();
                        atualizaGridDisciplinas();
                    }
                }
            })
        };

        admin.dialog(titulo, conteudo, callback);
    });
</script>
