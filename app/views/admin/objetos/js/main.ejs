<script>
        var ControllerObjetos = function (){
        this._elementosVisuais = {
                tituloAcao: $('#titulo-acao'),
                btnAcao: $('#btn-acao'),
                descricaoBtnAcao: $('#descricao-btn-acao'),
                btnCancelar: $('#btn-cancelar'),
                btnConsulta: $('#btnConsulta'),
                campoConsulta: $('#campo-consulta'),
                grid: $("#grid-objetos")
            };
        this._estado = 'cadastro';
        this._dados = { id: 0, descricao: '', ativo: true, tipoObjeto: 0 };
        this._formulario = { descricao: $('#descricao'), estado: { ativo: $('#ativo'), inativo: $('#inativo') }, tipoObjeto: $('#tipo-objeto') };
        this._urlBase = '/api/objetos/'
        var it = this;

        this.alternarEstado = function(estado, row) {
            switch(estado){
                case 'alteracao':
                    it._elementosVisuais.tituloAcao.html('alteração');
                    it._elementosVisuais.descricaoBtnAcao.html('Alterar');
                    it._formulario.descricao.val(row.objeto.descricao);
                    it._formulario.tipoObjeto.val(row.tipoObjeto.id);
                    it._formulario.estado.ativo.prop('checked', row.objeto.ativo)
                    it._formulario.estado.inativo.prop('checked', !row.objeto.ativo)
                    it._estado = 'alteracao';
                    it._dados = { id: row.objeto.id, descricao: row.objeto.descricao, ativo: row.objeto.ativo, tipoObjeto: row.tipoObjeto.id };
                    break;
                case 'cadastro':
                    it._elementosVisuais.tituloAcao.html('cadastro');
                    it._elementosVisuais.descricaoBtnAcao.html('Cadastrar');
                    $('#grid-cursos tr').removeClass('selected')
                    it._formulario.descricao.val('');
                    it._formulario.tipoObjeto.val(<%= tiposObjetos[0].id %>);
                    it._formulario.estado.ativo.prop('checked', true)
                    it._formulario.estado.inativo.prop('checked', false)
                    it._estado = 'cadastro';
                    it._dados = { id: 0, descricao: '', ativo: true, tipoObjeto: 0 };
                    break;
                default:
                    console.error('Valor inválido para alteração de estado');
                    break;
            }
        }

        this._elementosVisuais.btnAcao.on('click', function() {
            var objeto = { descricao: it._formulario.descricao.val(), ativo: it._formulario.estado.ativo.prop('checked'), tipoObjeto: it._formulario.tipoObjeto.val() };
            
            if(objeto.descricao.length === 0 || objeto.descricao.length > 120)
                return;
                
            var success = function (data, status) {
                $.Notify({ caption: data.title, content: data.msg, timeout: 10000, type: data.status });
                
                if (data.status === 'success') {
                    it.atualizaGrid();
                    it.alternarEstado('cadastro');
                }
            };

            switch (it._estado) {
                case 'cadastro':
                    $.ajax({
                        url: it._urlBase,
                        type: 'post',
                        data: { descricao: objeto.descricao, ativo: objeto.ativo, tipoObjeto: objeto.tipoObjeto },
                        success: success
                    })                    
                    break;
                case 'alteracao':
                    $.ajax({
                        url: it._urlBase + it._dados.id,
                        type: 'put',
                        data: { descricao: objeto.descricao, ativo: objeto.ativo, tipoObjeto: objeto.tipoObjeto },
                        success: success
                    })
                    break;
                default:
                    $.Notify({ caption: 'Erro na página.', content: 'Estado da página incorreto', timeout: 5000, type: 'alert' });
                    console.error('Estado do controller do tipo "ControllerObjetos" incorreto.');
                    break;
            }
        });

        this._elementosVisuais.btnCancelar.on('click', function(){
            it.alternarEstado('cadastro');
        });

        this._elementosVisuais.btnConsulta.on('click', function () {
            it.atualizaGrid();
        });

        this.formatarCampoEstado = function(ativo) { return ativo ? "Ativo" : "Inativo" };

        this._elementosVisuais.grid.bootstrapTable({
            url: it._urlBase,
            pageSize: 10,
            pagination: true,
            locale: 'pt-BR',
            queryParams: function(params){
                return {
                    limit: params.limit,
                    offset: params.offset,
                    order: params.order,
                    txConsulta: it._elementosVisuais.campoConsulta.val()
                };
            },
            sidePagination: 'server',
            columns: [
                { field: 'objeto.descricao', title: 'Objeto', halign: 'center', width: '45%' },
                { field: 'tipoObjeto.descricao', title: 'Categoria', width: '45%' },
                { field: 'objeto.ativo', title: 'Estado', width: '10%', formatter: it.formatarCampoEstado }
            ],
            onClickRow: function (row) {
                it.alternarEstado(it._dados.id === row.objetoid ? 'cadastro' : 'alteracao', row);
            }
        });

        this.atualizaGrid = function () {
            it._elementosVisuais.grid.bootstrapTable('refresh', {
                url: it._urlBase,
                query: { txConsulta: this._elementosVisuais.campoConsulta.val() }
            });
        }

        this._elementosVisuais.campoConsulta.keypress(function(event){
            if(event.key === 'Enter')
                it.atualizaGrid();
        });
    }
    
    var controllerObjeto = new ControllerObjetos();

    $("tbody").on("click", "tr", function (e) {
        $(this)
        .toggleClass("selected")
        .siblings(".selected")
        .removeClass("selected");
    });
</script>