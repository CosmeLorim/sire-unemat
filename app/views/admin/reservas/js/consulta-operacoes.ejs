<script>
    $('#btnConsultaOperacao').on('click', function ()
    {
        atualizarGridOperacoes();
    });

    $('#tabelaOperacoes').bootstrapTable({
        url: '/api/operacoes',
        pageSize: 10,
        pagination: true,
        locale: 'pt-BR',
        queryParams: function(params){
            return {
                limit: params.limit,
                offset: params.offset,
                order: params.order,
                txConsulta: $('#txConsultaOperacao').val()
            };
        },
        sidePagination: 'server',
        columns:[
            {field: 'descricao', title: 'Descrição', width: '40%'},
            {field: 'usuario', title: 'Usuário', width: '20%'},
            {field: 'disciplina', title: 'Disciplina', width: '10%'},
            {field: 'curso', title: 'Curso', width: '10%'},
            {field: 'objeto', title: 'Objeto', width: '20%'},
        ],
        onClickRow: function (row) {
            admin = new Admin();
            var titulo = 'Cancelamento de operações';
            var conteudo = '<p>Deseja cancelar a operacao '+row.descricao+'?</p>';
            var callback = function ()
            {
                $.ajax({
                    url: '/api/operacao/' + row.id,
                    type: 'delete',
                    success: function (data, status) {
                        $.Notify({
                            caption: data.title,
                            content: data.msg,
                            timeout: 10000,
                            type: data.status
                        });

                        if (data.status === 'success')
                        {
                            atualizarGridOperacoes();
                        }
                    }
                });
            };
            admin.dialog(titulo, conteudo, callback);
        }
    });

    function atualizarGridOperacoes()
    {
        $("#tabelaOperacoes").bootstrapTable('refresh', {
            url: "/api/operacoes",
            query: { txConsulta: $('#txConsultaOperacao').val() }
        });
    }
</script>